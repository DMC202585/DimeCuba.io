function loadCreditCards(selectedCard){var firstCreditCardsHTML="";var moreCreditCardsHTML="";var creditCardsPopupHTML='';var indexCard=0;let isSelected=null;if(pageName=='profile')
{$.each(globalPerson.creditCards,function(i,creditCard){var creditCardsHTML=createCardsHTML(creditCard);creditCardsPopupHTML+='<div id="favorite_popup_div_'+creditCard.id+'">'+'<input type="radio" name="selected_card_poup" id="selected_card_poup_'+creditCard.id+'" value="'+creditCard.id+'">'+'<label onclick="setTempSelected('+creditCard.id+')" for="selected_card_poup_'+creditCard.id+'" style="font-size: 16px;"> '+'<i class="fdc '+card_logo+'" style="font-size: 36px; margin-right: 10px;"></i> **** **** **** '+creditCard.last_four+' <i id="selected_mark_poup_'+creditCard.id+'" class="favorite_heart_poup fdc fdc-checkmark color-green" style="display: none">'+'</i></label></div>';if(selectedCard!==undefined&&creditCard.last_four==selectedCard)isSelected=creditCard.id;indexCard++});$("#credit_card_diferent_popup_content").html(creditCardsPopupHTML);if(isSelected!==null)setTempSelected(isSelected)}
else{if(globalPerson.creditCards===null||(globalPerson.creditCards!=null&&globalPerson.creditCards.length===0)){$('#newCreditCard').show();if(isWebview&&typeof globalPerson.paypalBraintree.paypalEmail!='undefined'&&globalPerson.paypalBraintree.paypalEmail!='')$('#no-payments-methods').show()}
else{$('#newCreditCard').hide();if(isWebview)$('#no-payments-methods').hide();$.each(globalPerson.creditCards,function(i,creditCard){if(creditCard.default==1||creditCard.id=="NEW"){var creditCardsHTML=createCardsHTML(creditCard);firstCreditCardsHTML+=creditCardsHTML;if(creditCard.default=="1")defaultCardId=creditCard.id;indexCard++}});$.each(globalPerson.creditCards,function(i,creditCard){if(creditCard.default==0&&creditCard.id!="NEW"){var creditCardsHTML=createCardsHTML(creditCard);if(indexCard<3)firstCreditCardsHTML+=creditCardsHTML;else moreCreditCardsHTML+=creditCardsHTML;creditCardsPopupHTML+='<div onmouseenter="animateHeartMouseOver('+creditCard.id+')" id="favorite_popup_div_'+creditCard.id+'" style="'+(creditCard.default=="1"?'display:none':'')+'"><input type="radio" name="favorite_card_poup" id="favorite_card_poup_'+creditCard.id+'" value="'+creditCard.id+'" style="display:none"><label onclick="setTempDefault('+creditCard.id+')" for="favorite_card_poup_'+creditCard.id+'" style="font-size: 16px;"> <i class="fdc '+card_logo+'" style="font-size: 36px; margin-right: 10px;"></i> **** **** **** '+creditCard.last_four+' <i id="favorite_heart_poup_'+creditCard.id+'" class="favorite_heart_poup fdc fdc-corazonfull color-red" style="display: none"></i></label></div>';indexCard++}})}
$('#credit_card_list .creditCard').remove();$('#credit_card_list').prepend(firstCreditCardsHTML);$('#credit_card_list_more').html(moreCreditCardsHTML);$("#credit_card_favorite_popup_content").html(creditCardsPopupHTML)}
loading('hide')}
function createCardsHTML(creditCard){var checked="";if(creditCardChosen.id===undefined&&creditCard.default==1){creditCardChosen=creditCard;paymentType=originalPaymentType="CC"}
if(creditCardChosen.id!==undefined&&creditCardChosen.id==creditCard.id){checked='checked="checked"'}
var creditCardsHTML='';if(!isWebview)creditCardsHTML+='<input type="radio" id="cc'+creditCard.id+'" name="credit-cards-radio" '+checked+' class="creditCard" onclick="selectCard(\''+creditCard.id+'\')">';else creditCardsHTML+='<input type="radio" id="cc'+creditCard.id+'" name="credit-cards-radio" '+checked+' class="creditCard" onclick="redirectToPayment(\''+creditCard.id+'\')">';creditCardsHTML+='<label id="card-'+creditCard.id+'" class="card card--front card--credit creditCard" for="cc'+creditCard.id+'">';if(creditCard.cardType==null)creditCard.cardType="";switch(creditCard.cardType){case 'American Express':if(!isWebview)creditCardsHTML+='<i class="fdc fdc-americanexpress card__logo" style="line-height: 0.5; margin-bottom: 24px;"></i>';else creditCardsHTML+='<i class="fdc fdc-americanexpress card__logo"></i>';card_logo='fdc-americanexpress';break;case 'MasterCard':if(!isWebview)creditCardsHTML+='<i class="fdc fdc-mastercard card__logo" style="line-height: 0.5; margin-bottom: 24px;"></i>';else creditCardsHTML+='<i class="fdc fdc-mastercard card__logo"></i>';card_logo='fdc-mastercard';break;case 'Discover':if(!isWebview)creditCardsHTML+='<i class="fdc fdc-discover card__logo" style="line-height: 0.5; margin-bottom: 24px;"></i>';else creditCardsHTML+='<i class="fdc fdc-discover card__logo"></i>';card_logo='fdc-discover';break;case 'VISA':if(!isWebview)creditCardsHTML+='<i class="fdc fdc-visa card__logo" style="line-height: 0.5; margin-bottom: 24px;"></i>';else creditCardsHTML+='<i class="fdc fdc-visa card__logo"></i>';card_logo='fdc-visa';break;default:if(!isWebview)creditCardsHTML+='<i class="fdc fdc-tarjeta card__logo" style="line-height: 0.5; margin-bottom: 24px;"></i>';else creditCardsHTML+='<i class="fdc fdc-tarjeta card__logo"></i>';card_logo='fdc-tarjeta';break}
creditCardsHTML+='<span class="card__type">**** **** **** '+creditCard.last_four+'</span>';creditCardsHTML+='<div class="card__footer" >';creditCardsHTML+='<span class="card__date"></span>';creditCardsHTML+='<span class="favorite-heart-container" id="favorite-heart-container_'+creditCard.id+'">';creditCardsHTML+=creditCard.default=="1"?'<i class="fdc fdc-corazonfull color-red"></i>':'';creditCardsHTML+='</span><div class="dropdown">';creditCardsHTML+='<a href="javascript:;" data-toggle="dropdown">';creditCardsHTML+='<i class="fdc fdc-gaveta03"></i>';creditCardsHTML+='</a>';creditCardsHTML+='<ul class="dropdown-menu dropdown-menu-right" id="dropdown-menu">';creditCardsHTML+='<li class="favorite-heart-li" id="favorite-heart-li_'+creditCard.id+'" style="'+(creditCard.default=="1"?'display:none':'')+'"><a href="javascript:;" onclick="setDefaultCreditCard(\''+creditCard.id+'\')"><i class="fdc fdc-corazonfull"></i> '+text_favorite+'</a></li>';creditCardsHTML+='<li><a href="javascript:;" onclick="deleteCreditCard(\''+creditCard.id+'\', \''+creditCard.last_four+'\', \''+card_logo+'\')"><i class="fdc fdc-eliminar"></i> '+text_delete+'</a></li>';creditCardsHTML+='</ul></div></div></label>';return creditCardsHTML}
function setTempDefault(cardId){$(".favorite_heart_poup").hide();$("#favorite_heart_poup_"+cardId).fadeIn("slow");$('#modal-card-favorite_btn').prop('disabled',!1)}
function setTempSelected(cardId){$("#selected_mark_poup_"+cardId).fadeIn("slow")}
function animateHeartMouseOver(cardId){if(!$("input[name=favorite_card_poup]").is(':checked')){$(".favorite_heart_poup").hide();$("#favorite_heart_poup_"+cardId).fadeIn("slow")}}
function newCardSelected(){$("#modal-new-card").modal("show")}
function selectCard(cardID,extraData){if(cardID=="paypal")paymentType="PP";else if(cardID=="paypal-credit")paymentType="PPC";else if(cardID=="balance")paymentType="BL";else if(cardID=="paypalBraintree")paymentType="PB";else if(cardID=="paypalBraintreeCredit")paymentType="PBC";else if(cardID=="googlePayBraintree")paymentType="GPBT";else if(cardID=="applePayBraintree")paymentType="APBT";else if(cardID=="tropipay")paymentType="TRP";else paymentType="CC";originalPaymentType=paymentType;if((cardID=='paypalBraintree'||cardID=='paypalBraintreeCredit'||cardID=='paypal'||cardID=='paypal-credit')&&typeof extraData!='undefined')payerBraintreeEmail=extraData;if(cardID=="paypalBraintree"||cardID=="paypalBraintreeCredit"||cardID=="tropipay"){$("div#autorecharge").fadeOut("fast")}else{$("div#autorecharge").fadeIn("fast")}
if(cardID=="NEW")creditCardChosen=newCardChosen;else{$.each(globalPerson.creditCards,function(i,creditCard){if(creditCard.id==cardID)creditCardChosen=creditCard})}}
function getPaymentTypeString(paymentType){if(paymentType=="CC")return `Tarjeta **** **** **** ${creditCardChosen.last_four}`;if(paymentType=="PP")return "PayPal";if(paymentType=="PB")return "PayPal";if(paymentType=="PBC")return "PayPal Credit";if(paymentType=="GPBT")return "Google Pay";if(paymentType=="APBT")return "Apple Pay";if(paymentType=="BL")return "Saldo DimeCuba";if(paymentType=="TRP")return "TropiPay";return "Otro"}
function deleteCreditCard(card_id,last_four,card_logo){$("input[name=favorite_card_poup]").prop("checked",!1);$(".favorite_heart_poup").hide();$("#modal-card-remove_card_id").val(card_id);$("#modal-card-remove_last_four").html(last_four);$("#modal-card-remove-card_logo").html('<i class="fdc '+card_logo+' card__logo"></i>');if(card_id==defaultCardId&&globalPerson.creditCards.length>1){$('#modal-card-favorite_btn').prop('disabled',!0);$("#modal-favorite-card").modal("show")}
else{$("#modal-card-remove").modal("show")}
if(isWebview&&globalPerson.creditCards.length==0&&(typeof globalPerson.paypalBraintree.paypalEmail=='undefined'||globalPerson.paypalBraintree.paypalEmail==''))
$('#no-payments-methods').show()}
function setDefaultCreditCard(card,noshowload){noshowload=noshowload===!0?!1:!0;if(card=="NEW"){$.each(globalPerson.creditCards,function(i,creditCard){if(creditCard.id=="NEW")creditCard.default=1;else creditCard.default=0});$(".favorite-heart-container").html('');$("#favorite-heart-container_"+card).html('<i class="fdc fdc-corazonfull color-red"></i>');$(".favorite-heart-li").show();$("#favorite-heart-li_"+card).hide();$("#favorite_popup_div_"+card).hide();$("#favorite_popup_div_"+defaultCardId).show();defaultCardId=card}
else{var newcards=[]
$.each(globalPerson.creditCards,function(i,creditCard){if(creditCard.id=="NEW"){creditCard.default=0;newcards.push(creditCard)}});loadAsync({id:card},'setDefaultCreditCardAsync',function(data){if(data.status){data.items.creditCards=newcards.concat(data.items.creditCards);voidCallback(data);loadCreditCards();defaultCardId=card;if(pageName=='profile'){setTimeout(function(){location.reload()},500)}
flashMessage(data_modified,'success')}
else{flashMessage(text_error,'error')}},noshowload)}}
function process3DSecure(info){var threeDSecure;loading('show');loadAsync(info.payment.creditcard,"getCustomerIdTo3DSecure",function(response){if(response.required){var customerId=response.customerId;var creditCardId=response.creditCardId;loadAsync({customerId:customerId},"getBraintreeServerToken",function(result){braintree.client.create({authorization:result.token},function(clientErr,clientInstance){if(clientErr){flashMessage("No hemos podido verificar tu tarjeta","error");return}
braintree.threeDSecure.create({client:clientInstance},function(threeDSecureErr,threeDSecureInstance){if(threeDSecureErr){flashMessage("No hemos podido verificar tu tarjeta","error");return}
threeDSecure=threeDSecureInstance;loading('hide');threeDSecure.verifyCard({amount:totalAmount,nonce:creditCardId,addFrame:function(err,iframe){$('#modal-3ds .modal-content').append(iframe);$('#modal-3ds').modal({show:!0,keyboard:!1,backdrop:'static'})},removeFrame:function(){$('#modal-3ds .modal-content').remove();$('#modal-3ds').modal('hide')}},function(err,response){if(err){flashMessage("No hemos podido verificar tu tarjeta","error");var data={"first_six":info.person.creditCard.first_six,"last_four":info.person.creditCard.last_four,"token":customerId,"code":err.code,"messageError":err.message};loadAsync(data,"createAlarm3dSecure");return}
info.payment.creditcard.threeDSecureToken=response.nonce;loadAsync(info,"addBalanceAsync",finishPaymentCallback,!0)})})})},!1)}else{loading('hide');setTimeout(function(){loadAsync(info,"addBalanceAsync",finishPaymentCallback,!0)},500)}},!1)}
function getCardTypeIcon(cardType){switch(cardType){case 'American Express':card_logo='fdc-americanexpress';break;case 'MasterCard':case 'MasterCard':card_logo='fdc-mastercard';break;case 'Discover':card_logo='fdc-discover';break;case 'VISA':default:card_logo='fdc-visa';break}
return card_logo}